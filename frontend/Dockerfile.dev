FROM node:18-alpine

# Install git and increase network timeout/retries for stable install
RUN apk add --no-cache git && \
    npm config set fetch-retries 5 && \
    npm config set fetch-retry-mintimeout 20000 && \
    npm config set fetch-retry-maxtimeout 120000

WORKDIR /frontend

COPY package*.json ./

# Use ci (Clean Install) if you have a package-lock.json, otherwise keep install
# Added --prefer-offline to use cache if a retry happens
RUN npm install --legacy-peer-deps --prefer-offline

COPY . .

EXPOSE 3000

# We use npx to ensure we find the local react-scripts
CMD ["npm", "start"]